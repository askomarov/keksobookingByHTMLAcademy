(()=>{"use strict";const e=(e,t,o)=>{e.setAttribute(t,o)},t=e=>{const t=document.createElement("div");t.style.zIndex=1e3,t.style.position="absolute",t.style.left="50%",t.style.top="50%",t.style.width="320px",t.style.height="auto",t.style.transform="translate(-50%, -50%)",t.style.padding="10px 3px",t.style.fontSize="30px",t.style.textAlign="center",t.style.backgroundColor="tomato",t.textContent=e,document.body.append(t),setTimeout((()=>{t.remove()}),5e3)},o=e=>"Escape"===e.key,r=document.querySelector("#card").content.querySelector(".popup"),n=document.querySelector("#map-canvas"),a=L.map(n),c=L.icon({iconUrl:"img/main-pin.svg",iconSize:[52,52],iconAnchor:[26,52]}),s=L.marker({lat:35.6817,lng:139.753882},{draggable:!0,icon:c}),l=L.icon({iconUrl:"img/pin.svg",iconSize:[40,40],iconAnchor:[20,40]}),d=document.querySelector(".ad-form").querySelector("#address"),i=[],u=e=>{e.slice(0,10).forEach((e=>{const t=L.marker({lat:e.location.lat,lng:e.location.lng},{icon:l});t.addTo(a).bindPopup((e=>{const t=r.cloneNode(!0);return((e,t)=>{var o;t.querySelector(".popup__avatar").src=e.author.avatar,t.querySelector(".popup__features").innerHTML="",t.querySelector(".popup__title").textContent=e.offer.title,t.querySelector(".popup__text--address").textContent=e.offer.address,t.querySelector(".popup__text--price").firstChild.textContent=e.offer.price+" ",t.querySelector(".popup__type").textContent="flat"===(o=e).offer.type?"Квартира":"bungalow"===o.offer.type?"Бунгало":"palace"===o.offer.type?"Дворец":"house"===o.offer.type?"Дом":void 0,t.querySelector(".popup__text--capacity").textContent=`${e.offer.rooms} команты для ${e.offer.guests} гостей`,t.querySelector(".popup__text--time").textContent=`Заезд после ${e.offer.checkin}, выезд до ${e.offer.checkout}`,t.querySelector(".popup__description").textContent=e.offer.description,t.querySelector(".popup__photos").innerHTML=""})(e,t),((e,t)=>{const o=t.querySelector(".popup__features");0===e.offer.features.length&&o.remove(),e.offer.features.forEach((e=>{const t=`<li class="popup__feature popup__feature--${e}"></li>`;o.insertAdjacentHTML("beforeend",t)}))})(e,t),((e,t)=>{const o=t.querySelector(".popup__photos");0===e.offer.photos.length&&o.remove(),e.offer.photos.forEach(((e,t)=>{const r=`<img src="${e}" class="popup__photo" width="45" height="40" alt="Фотография жилья ${t+1}">`;o.insertAdjacentHTML("beforeend",r)}))})(e,t),t})(e),{keepInView:!0}),i.push(t)}))},p=(e,t,o)=>fetch(e,{method:"GET",credentials:"same-origin"}).then((e=>{if(e.ok)return e.json();throw new Error(`${e.status} ${e.statusText}`)})).then((e=>{t(e)})).catch((e=>{o(e)})),f=["gif","jpg","jpeg","png"],m=document.querySelector("#avatar"),y=document.querySelector(".ad-form-header__preview > img"),v=document.querySelector("#images"),h=document.querySelector(".ad-form__photo"),g=document.querySelector(".ad-form"),b=g.querySelectorAll("fieldset"),S=document.querySelector(".ad-form__reset"),q=document.querySelector(".map__filters"),E=q.querySelectorAll("select"),k=q.querySelectorAll("fieldset"),A=document.querySelector("#room_number"),x=document.querySelector("#capacity"),w=()=>{g.classList.add("ad-form--disabled"),b.forEach((e=>{e.setAttribute("disabled","disabled")})),q.classList.add("map__filters--disabled"),k.forEach((e=>{e.setAttribute("disabled","disabled")})),E.forEach((e=>{e.setAttribute("disabled","disabled")}))},C=()=>{g.classList.remove("ad-form--disabled"),b.forEach((e=>{e.removeAttribute("disabled")}))},T=document.querySelector("#type"),$=document.querySelector("#price"),j=()=>"bungalow"===T.value?"0":"flat"===T.value?"1000":"palace"===T.value?"10000":"house"===T.value?"5000":void 0,D=document.querySelector("#timein"),z=document.querySelector("#timeout"),M=(e,t)=>{e.addEventListener("change",(()=>{let o=t.options;for(let t=0;t<o.length;t++)o[t].value===e.value&&(o[t].selected=!0)}))},F=document.querySelector("#error").content.querySelector(".error"),N=document.querySelector("main"),H=e=>{o(e)&&(e.preventDefault(),I())},I=()=>{document.querySelector(".error").remove(),document.removeEventListener("keydown",H)},R=e=>{I(),e.target.removeEventListener("click",R)},U=()=>{const e=F.cloneNode(!0);N.append(e),document.querySelector(".error__button").addEventListener("click",R),document.addEventListener("keydown",H)},O=document.querySelector("#success").content.querySelector(".success"),P=()=>{document.querySelector(".success").remove(),document.removeEventListener("keydown",W),document.removeEventListener("click",V)},V=()=>{P()},W=e=>{o(e)&&(e.preventDefault(),P())},G=()=>{g.reset(),q.reset(),s.setLatLng([35.6817,139.753882]),y.src="img/muffin-grey.svg",h.style.backgroundImage="",i.forEach((e=>{e.addTo(a)}))},B=document.querySelector(".map__filters"),J=B.querySelector("#housing-type"),K=B.querySelector("#housing-price"),Q=B.querySelector("#housing-rooms"),X=B.querySelector("#housing-guests"),Y=e=>(e=>"any"===J.value||e.offer.type===J.value)(e)&&(e=>"any"===K.value||("middle"===K.value?e.offer.price>=1e4&&e.offer.price<5e4:"low"===K.value?e.offer.price<1e4:"high"===K.value&&e.offer.price>=5e4))(e)&&(e=>{const t=B.querySelectorAll(".map__checkbox:checked");if(0===t.length)return!0;for(let o of t)if(!e.offer.features.includes(o.value))return!1;return!0})(e)&&(e=>"any"===Q.value||e.offer.rooms===Number(Q.value))(e)&&(e=>"any"===X.value||e.offer.guests===Number(X.value))(e),Z="https://22.javascript.pages.academy/keksobooking/data";w();const ee=e=>{var t;u(e),t=e,B.addEventListener("change",_.debounce((()=>(e=>{const t=e.filter(Y);i.forEach((e=>{e.remove()})),u(t)})(t)),500)),q.classList.remove("map__filters--disabled"),k.forEach((e=>{e.removeAttribute("disabled")})),E.forEach((e=>{e.removeAttribute("disabled")}))},te=()=>{(()=>{const e=O.cloneNode(!0);N.append(e),document.addEventListener("keydown",W),document.addEventListener("click",V),G()})(),p(Z,ee,t)};document.addEventListener("DOMContentLoaded",(()=>{var o,r,n;(()=>{try{a.on("load",(()=>{var e;C(),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(a),s.addTo(a),e=d,s.on("moveend",(t=>{const o=t.target.getLatLng(),r=o.lat.toFixed(5),n=o.lng.toFixed(5);e.value=`${r}, ${n}`}))})).setView({lat:35.6817,lng:139.75388},13)}catch(e){t(e),w()}})(),p(Z,ee,t),e($,"placeholder",j()),e($,"min",j()),T.addEventListener("change",(()=>{e($,"placeholder",j()),e($,"min",j())})),M(D,z),M(z,D),A.addEventListener("change",(()=>{((e,t)=>{const o=t.options;if("1"===e.value)for(let e=0;e<o.length;e++){const t=o[e];"1"!==t.value?(t.selected=!1,t.setAttribute("disabled","disabled")):(t.removeAttribute("disabled","disabled"),t.selected=!0)}if("2"===e.value)for(let e=0;e<o.length;e++){const t=o[e];"1"===t.value||"2"===t.value?(t.selected=!0,t.removeAttribute("disabled","disabled")):(t.setAttribute("disabled","disabled"),t.selected=!1)}if("3"===e.value)for(let e=0;e<o.length;e++){const t=o[e];"0"===t.value?(t.selected=!1,t.setAttribute("disabled","disabled")):(t.removeAttribute("disabled","disabled"),t.selected=!0)}if("100"===e.value)for(let e=0;e<o.length;e++){const t=o[e];"0"===t.value?(t.selected=!0,t.removeAttribute("disabled","disabled")):(t.setAttribute("disabled","disabled"),t.selected=!0)}})(A,x)})),o="https://22.javascript.pages.academy/keksobooking",r=te,n=U,g.addEventListener("submit",(e=>{e.preventDefault(),((e,t,o,r)=>{fetch(e,{method:"POST",body:t}).then((e=>{e.ok?o():r()})).catch((()=>{r()}))})(o,new FormData(e.target),r,n)})),S.addEventListener("click",(()=>{G()})),m.addEventListener("change",(()=>{const e=m.files[0],t=e.name.toLowerCase();if(f.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{y.src=t.result})),t.readAsDataURL(e)}})),v.addEventListener("change",(()=>{const e=v.files[0],t=e.name.toLowerCase();if(f.some((e=>t.endsWith(e)))){const t=new FileReader;t.addEventListener("load",(()=>{h.style.backgroundImage=`url('${t.result}')`,h.style.backgroundSize="cover"})),t.readAsDataURL(e)}}))}))})();
//# sourceMappingURL=main.bundle.js.map